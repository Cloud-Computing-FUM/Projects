

با سلام خدمت دانشجویان گرامی. پروژه به صورت فاز بندی شده شامل موارد ذیل می باشد:
 (لازم به ذکر است که برای ابزار های Kubernetes , Docker آموزش های مربوطه قرار خواهد گرفت)
## Phase 1 (Dockerizing-Composition):
   ---
   ## نکات: 
   
   ابزارهای Docker و Docker Compose را نصب کنید. از آنجا که تحریم هستیم دو روش برای نصب داکر و مراحل بعد از آن نظیر دریافت ایمیج ها و یا راسال ایمیج خود به مخزن داکرهاب برای شما ارائه می شود.

۱. تنظیم کردن شکن به عنوان DNS . برای انجام این کار به فایل زیر بروید و رکورد های زیر را به آن بیافزایید.
```
/etc/resolve.conf
```
```
nameserver 178.22.122.100
nameserver 185.51.200.2
```
خط زیر را کامنت کنید:
```
nameserver 127.0.0.53
```
۲. روی [این لینک](https://github.com/freedomofdevelopers/fod/blob/master/README.md)  کلیک کنید تا با استفاده از پروکسی ای که روی ماشین مجازی تنظیم می کنید ، تحریم ها را دور بزنید.


پس از انجام یکی از مراحل یاد شده، برای نصب Docker و Docker Compose از [این لینک](https://docs.docker.com/engine/install/) استفاده کنید و در  صفحه مذکور، در بخش Server روی توزیع ماشین مجازی ای که در اختبارتان قرار گرفته (یا ماشین مجازی موجود روی سیستم شخصی خود) کلیک کرده تا دستورات نصب آن را مشاهده کنید.

-------
## روش پیاده سازی:


  ۱. انتخاب یک image از وب سرور های موجود نظیر apache , nginx ,...
  
  ۲. با استفاده از image وب سرور انتخابی خود، Dockerfile ای نوشته که نوشته که یکی از دو task زیر را انجام دهد:
  	۲.۱. به عنوان reverse proxy برای یک برنامه ساده، که در همین مخزن در اختیارتان قرار گرفته، عمل کند. (ارتباط تحت socket با WSGI نیز بلامانع است.)
  	۲.۲. یک صفحه html را میزبانی کند.
  	۲.۳. در نظر داشته باشید که انتخاب مورد اول، بسته به روش configuration و معماری، **می‌تواند** شامل نمره اضافه شود.
  	۲.۴. در نهایت وب سرور شما باید محتویات یک پوشه **خارج از container** را برای دانلود میزبانی کند.
  	۲.۵. در انتخاب راه configuration وب سرور انتخابی خود مختار هستید. (کپی کردن داخل image یا با کمک یک volume) 

  ۳. انتخاب یک image از دیتابیس های موجود نظیر mongodb , mysql , elasticsearch , ... 
  
  ۳.۱. کانفیگ مرتبط با این image باید در docker-compose.yml نوشته شود و ویژگی های زیر را دارا باشد:
  
  ۱. باید stateful باشد، به این معنی که با از بین رفتن و به وجود آمدن کانتینر ، دیتابیس ما همچنان به داده‌‌های پیش از حذف شدن container،‌دسترسی داشته باشد.

  ۲. برای استفاده هر container از cpu و ram، محدودیتی به دل‌خواه اعمال شود.
 
  ۳.  برای دیتابیس مورد نظر خود نام کاربری و رمز عبور مجزا تعریف کنید.

  ۴. در فایل docker-compose.yml با استفاده از Dockerfile مورد ۳ عملیات  build انحام شود و هر دو image با یک دیگر اجرا شوند.
  
  ۵. ایمیج بیلد شده خود را در داکر هاب push کنید و لینک آن را نیز در issue  تحویل فاز ۱ برای ما قرار دهید. (در صورتی که تعداد imageهایتان از محدودیت dockerhub بیشتر بود، از یک private registry استفاده کنید.)
  
## نکات:
در سایت [داکر هاب](https://hub.docker.com/search) می توانید ایمیج های  وب سرور و یا دیتابیس مد نظر خود را بیابید. البته رجیستری های بسیاری وجود دارند که از آن ها نیز می توانید بهره ببرید و حتی خود شما نیز می توانید یک رجیستری راه اندازی کنید. اما ما داکرهاب را پیشنهاد می دهیم.

 داکیومنت کاملی از اجزا و بسیاری از عناصر docker compose file را می توانید در [این لینک](https://docs.docker.com/compose/compose-file/) مشاهده کنید و از آن در پیاده سازی فاز ۱ خود کمک بگیرید. 

 همچنین با مطالعه [این لینک](https://docs.docker.com/engine/reference/builder/) می توانید رفرنس کاملی از عناصر و اصول نوشتن Dockerfile داشته  و جهت پیاده سازی فاز ۱ از آن بهره مند باشید

---
## Phase 2 (Orchestrator):

از سوی TA ها سرور در اختیار دانشجویان قرار می گیرد تا روی آن orchestrator راه اندازی شود. پیشنهاد ما minikube است، زیرا راه اندازی آن از کلاستر کوبرنتیز راحت تر است.

## نکات:
برای راه اندازی minikube می توانید از [این لینک](https://minikube.sigs.k8s.io/docs/start/) بهره ببرید.
اگر مایل به راه اندازی kubernetes بودید از [این لینک](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/) استفاده کنید اما ما به دلیل محدودیت منابع ، راه اندازی کلاستر  Kubernetes را توصیه نمی کنیم.

---
## Phase 3 (Migration):

مهاجرت از  Docker Compose که برای محیط develop مناسب است به محیط production یعنی فایل های کانفیگ kubernetes
در این فاز باید موارد زیر رعایت شود:
```
۱. ReplicaSet
 برای پاد های دیتابیس ها صورت بگیرد 


۲. بین پاد ها انجام شود LoadBalance


۳. با از کار افتادن یک پاد ، دیگر پاد ها به کار خود ادامه دهند

۴. Networking با استفاده از 
 IP کوبرنتیز ، دسترسی با استفاده از 
 هاست به وب سرور مهیا شود

 ۵. استفاده شود ConfigMap برای نگهداری متغیر ها ، از 
  
 ۶. برای نگهداری و هنگام استفاده از 
  ...ها و API Key رمز ها و 
  استفاده شود Secret از
   در کد استفاده شود plain text و نباید از آن ها به صورت 

۷. محدود شوند CPU , Ram منابع مصرفی نظیر 

۸. ذخیره شوند Persistant Volume  داده های دیتابیس باید به صورت 
```
توصیه ما برای راهنما گرفتن جهت پیاده سازی این فاز ، مطالعه بخش Tutorial , Concept های [سایت خود Kubernetes](https://kubernetes.io/docs/) می باشد. چرا که داکیومنت های جامع و کاربر پسند دارد.

متاسفانه در گذشته Katacoda پلتفرم آموزشی بخش بخش پروژه محور برای Kubernetes به صورت رایگان قرار داده بود که گویا حذف شده. در صورت یافتن گزینه ای با کیفیت معرفی خواهد شد. 

---
## Phase 4 (Monitoring):
این فاز نمره اضافه می باشد.

راه اندازی Prometheus و Grafana جهت مانیتور کردن pod ها.

[!] این فاز بسته به خلاقیت شما و انواع چارت و گرافی که قرار می دهید نمره می گیرد و سقف نمره آن برای کسی که بهترین پیاده سازی را داشته باشد در نظر گرفته خواهد  شد.


## نکاتی در رابطه با روش تحویل
۱.
تحویل ها به این شکل خواهد بود که لینک repository خود را به صورت issue در همین ریپو برای ما ارسال خواهید کرد.
 و در تحویل هر فاز آخرین commit شما پیش از deadline در نظر گرفته خواهد شد.

 ۲.  برای تست دیتابیس ترجیحا اسکریپتی نوشته تا از عملکرد صحیح آن مطمئن شویم و در ریپوی خود قرار دهید. در غیر این صورت باید به صورت دستی هنگام تحویل عملکرد آن را از طریق شل خود دیتابیس نشان دهید. 

 ۳. در هنگام تحویل هر فرد به صورت جداگانه ارزیابی خواهد شد و نمره یکسان برای کل تیم در نظر گرفته نخواهد شد و ملاک نمره دهی ، تسلط هر شخص بر پروژه و مفاهیم خواهد بود

 
